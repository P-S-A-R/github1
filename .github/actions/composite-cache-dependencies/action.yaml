name: Cache Node and NPM dependncies
description: caches node and npm dependencies based on package-lock.json files  

inputs:
 node-version:
  description: node js version to use 
  default: 20.x
  required: true 
 Working-dir:
  description: working directory of the application 
  default: .
  required: false
 target-env:
  description: controlls dependencies installed, dev or prod
  default: dev
  required: false

runs: 
  using: composite
  steps:
   - name: setup Nodejs version ${{ inputs.node-version }}
     uses: actions/setup-node@v3
     with:
      node-version: ${{ inputs.node-version}}
   - name: cache dependencies
     id: cache
     uses: actions/cache@v3
     with:
      path: ${{ inputs.working-dir }}/node_modules
      key: node-modules-${{ hashFiles( format ('{0}/{1}', inputs.working-dir, 'package-lock.json' )) }}
   - name: install dependencies
     if: steps.cache.outputs.cache-hit != 'true'
     run: ${{ inputs.target-env == 'dev' && 'npm ci' || 'npm ci --omit=dev'}}
     shell: bash
     working-directory: ${{ inputs.working-dir }}
  